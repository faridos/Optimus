{% extends "FrontOfficeOptimusBundle::layout.html.twig" %}
{% block body %}

    <div id="wrapper">
        <div id="mapView" class="mob-min"><div class="mapPlaceholder"><span class="fa fa-spin fa-spinner"></span> Loading map...</div> </div>

        <div id="content" class="mob-max" >

            <div class="col-lg-12"><div class="row mb20">

                </div>

                <div class="row">
                    <form action="{{ path('update-event', { 'id' : event.id}) }}" method="post">
                        {{ form_errors(edit_form) }}
                        <div class="col-xs-12 ">
                            <div class="panel panel-default">
                                <div class="panel-heading optimus"> <span class="navLabel">Ajouter un évenement</span></div>
                                <div class="panel-body">

                                    <div class="form-group col-xs-6">
                                    {{ form_widget(edit_form.titre) }}
                                    </div>
                                    <div class="form-group col-xs-6">
                                        {{ form_widget(edit_form.type) }}
                                     </div>
                                    <div class="form-group col-xs-6">
                                        {{ form_widget(edit_form.nbrPlaces) }}                                      
                                    </div>


                                    <div class="form-group col-xs-6">

                                        <div class="input-group search-optimus">
                                            {{ form_widget(edit_form.frais) }}
                                            <div class="input-group-addon round ">&euro;</div>
                                        </div>
                                    </div> 
                                    <div class="form-group col-xs-6">

                                        {{ form_widget(edit_form.dateDebut, { 'id': 'some_class_1' }) }}
                                       
                                    </div>
                                    <div class="form-group col-xs-6">

                                        {{ form_widget(edit_form.dateFin, { 'id': 'some_class_2' }) }}
                                                                            
                                    </div>
                                        <div class="form-group col-xs-8 col-xs-offset-2" >

                                     {{ form_widget(edit_form.description) }}
                                                                            
                                    </div>
                                        

                                </div>
                            </div>

                        </div> 


                        <div class="col-xs-12 ">
                            <div class="panel panel-default">
                                <div class="panel-heading optimus">veuiller choisir l'emplacement d'évenement dans la map</div><div class="panel-body">
                                    <div class="form-group col-xs-12">
                                        {{ form_widget(edit_form.lieu , { 'id': 'lieu' }) }}
                                        
                                    </div>


                                    <div class="form-group col-xs-6 " style="display: none; visibility: hidden;">
                                        {{ form_widget(edit_form.lat, { 'id': 'lat_id' }) }}
                                       
                                    </div>
                                    <div class="form-group col-xs-6 " style="display: none; visibility: hidden;">

                                        {{ form_widget(edit_form.lng, { 'id': 'lng_id' }) }}
                                    </div>
                                   

                                    
                                </div></div>
                        </div>
                                    <div style="text-align: center">

                                        <button type="submit" value="Submit" class="btn btn-round btn-green">Modifier</button>
                                        <button type="{{path('show_event',{id: event.id})}}" class="btn btn-round btn-green">Annuler</button>
                                    </div>

    {{ form_widget(edit_form._token) }}
    {{ form_rest(edit_form) }}
                    </form>
                </div>

            </div>
        </div>

        <div class="clearfix"></div>
    </div>


{% endblock %}
{% block javascriptfils %}
    <script>

        var markerevent;
        var geocoder;
        var latlng2 = new google.maps.LatLng({{event.lat}}, {{event.lng}});
        geocoder = new google.maps.Geocoder();
        placeMarker(latlng2);
                
        google.maps.event.addListener(map, 'click', function(event) {

            document.getElementById('lat_id').value = event.latLng.lat();
            document.getElementById('lng_id').value = event.latLng.lng();
            //latlng = event.latLng;
            var latlng = new google.maps.LatLng(event.latLng.lat(), event.latLng.lng());
            //latlng = event.latLng;

            geocoder.geocode({
                'latLng': latlng
            }, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        document.getElementById('lieu').value = results[0].formatted_address;
                       placeMarker(event.latLng);
                    } else {
                        alert('No results found');
                    }
                } else {
                    alert('Geocoder failed due to: ' + status);
                }

            });
            
        });
        function placeMarker(location) {

            if (markerevent === undefined) {
                markerevent = new google.maps.Marker({
                    position: location,
                    map: map,
                    draggable: true,
                    animation: google.maps.Animation.DROP,
                });
                markerevent.setIcon('/Optimus/web/template/images/marker-green.png');
            }
            else {
                markerevent.setPosition(location);
            }
        }
    </script>
{% endblock %}
