{% extends "FOSUserBundle::layout.html.twig" %}
{% block stylesheets %}
    <link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
    <link href="{{ asset('template/css/form.css') }}" rel="stylesheet">
{% endblock %}
{% block nav %}

{% endblock %}   
{% block body %}
    <div id="home-map" ></div>
    <div class="home-caption">

        <div class="home-subtitle" style="">
            <div class="col-md-4 col-md-offset-4">
                {% block fos_user_content %}
                    {% include "FOSUserBundle:Registration:register_content.html.twig" %}
                {% endblock fos_user_content %}	


            </div>

        </div>

    </div>
    <div class="search-panel">
        <form class="form-inline" role="form">
            <div class="form-group">
                <img src="{{ asset('template/images/marker-green.png') }}">"&gt;
            </div>
            <div class="form-group">
                <input style="border-radius:25px" type="text" class="form-control" id="pac-input2" placeholder="Entrer ici votre rÃ©gion" autocomplete="on" size="60">
            </div>
            <div class="form-group">
                <a id="btn-input" class="btn btn-round btn-green btn-m">Ma position actuelle</a></div>
        </form>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('template/js/animation.js') }}" type="text/javascript"></script> 
    <script src="{{ asset('templatejs/document.js') }}" type="text/javascript"></script>
    <script>
        var pos;
(function($) {
    "use strict";

    var options = {
            zoom : 14,
            mapTypeId : 'Styled',
            disableDefaultUI: true,
            mapTypeControlOptions : {
                mapTypeIds : [ 'Styled' ]
            },
            scrollwheel: true
        };
    var styles = [{
        stylers : [ {
            hue : "#cccccc"
        }, {
            saturation : -100
        }]
    }, {
        featureType : "road",
        elementType : "geometry",
        stylers : [ {
            lightness : 100
        }, {
            visibility : "simplified"
        }]
    }, {
        featureType : "road",
        elementType : "labels",
        stylers : [ {
            visibility : "on"
        }]
    }, {
        featureType: "poi",
        stylers: [ {
            visibility: "off"
        }]
    }];

    var markers = [];

 var map;
    setTimeout(function() {
        $('body').removeClass('notransition');

        if ($('#home-map').length > 0) {
            map = new google.maps.Map(document.getElementById('home-map'), options);
            var styledMapType = new google.maps.StyledMapType(styles, {
                name : 'Styled'
            });

            map.mapTypes.set('Styled', styledMapType);
            
            map.setZoom(12);

    
            
            if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                         pos = new google.maps.LatLng(position.coords.latitude,
                                position.coords.longitude);



                        var newMarker = new google.maps.Marker({
                            position: pos,
                            map: map,
                            icon: new google.maps.MarkerImage('template/images/marker-position.png'),
                            draggable: true,
                            animation: google.maps.Animation.DROP,
                        });

                        map.setCenter(pos);
                        
                    }, function () {
                        handleNoGeolocation(true);
                    });
                } else {
                    handleNoGeolocation(false);
                }
                
                var btn = (document.getElementById('btn-input'));
                google.maps.event.addDomListener(btn, 'click', function () {
                    map.setCenter(pos),
                    map.setZoom(12)

                });
                
                var input = (document.getElementById('pac-input2'));
                
                var searchBox = new google.maps.places.SearchBox((input));
                
                google.maps.event.addListener(searchBox, 'places_changed', function () {
                    var places = searchBox.getPlaces();

                    if (places.length == 0) {
                        return;
                    }
//                    for (var i = 0, marker; marker = markers[i]; i++) {
//                        marker.setMap(null);
//                    }

                    // For each place, get the icon, place name, and location.
                    markers = [];
                    var bounds = new google.maps.LatLngBounds();
                    for (var i = 0, place; place = places[i]; i++) {
                        var image = {
                            url: place.icon,
                            size: new google.maps.Size(71, 71),
                            origin: new google.maps.Point(0, 0),
                            anchor: new google.maps.Point(17, 34),
                            scaledSize: new google.maps.Size(25, 25)
                        };


                        bounds.extend(place.geometry.location);
                    }

                    map.fitBounds(bounds);
                    map.setZoom(12);
                    
                    
                });
              
                google.maps.event.addListener(map, 'bounds_changed', function () {
                    var bounds = map.getBounds();
                    searchBox.setBounds(bounds);
                });
                
        }
    }, 300);

    if(!(('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch)) {
        $('body').addClass('no-touch');
    }

     $('.dropdown-select li a').click(function() {
        if (!($(this).parent().hasClass('disabled'))) {
            $(this).prev().prop("checked", true);
            $(this).parent().siblings().removeClass('active');
            $(this).parent().addClass('active');
            $(this).parent().parent().siblings('.dropdown-toggle').children('.dropdown-label').html($(this).text());
        }
    });

    var cityOptions = {
        types : [ '(cities)' ]
    };
    var city = document.getElementById('city');
    var cityAuto = new google.maps.places.Autocomplete(city, cityOptions);

    $('#advanced').click(function() {
        $('.adv').toggleClass('hidden-xs');
    });

    $('.home-navHandler').click(function() {
        $('.home-nav').toggleClass('active');
        $(this).toggleClass('active');
    });

    //Enable swiping
    $(".carousel-inner").swipe( {
        swipeLeft:function(event, direction, distance, duration, fingerCount) {
            $(this).parent().carousel('next'); 
        },
        swipeRight: function() {
            $(this).parent().carousel('prev');
        }
    });

    $('.modal-su').click(function() {
        $('#signin').modal('hide');
        $('#signup').modal('show');
    });

    $('.modal-si').click(function() {
        $('#signup').modal('hide');
        $('#signin').modal('show');
    });

    $('input, textarea').placeholder();

})(jQuery);

    </script>
{% endblock %}